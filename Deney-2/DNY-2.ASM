list p=16F877
INCLUDE <P16F877.INC>
__config H'3F31'

COUNTER		EQU	0X22
REFERENCE	EQU	0X23

COUNTER2	EQU	0X24
COUNTER3	EQU	0X25		

	ORG 	0X00
	GOTO 	SETUP

	ORG 	0X04
	GOTO	INTERRUPT

INTERRUPT

	BTFSS	PIR1,TMR1IF
	RETFIE
	BCF		PIR1,TMR1IF
	
	BANKSEL	TMR1H

	MOVLW	0X3C
	MOVWF	TMR1H
	MOVLW	0XB0
	MOVWF	TMR1L
	DECFSZ	COUNTER,1
	RETFIE
	MOVF	REFERENCE,W
	MOVWF	COUNTER
	INCF	PORTB,F
	RETFIE

SETUP
	
	BANKSEL	ADCON1
	MOVLW	0X06
	MOVWF	ADCON1

	BANKSEL	TRISB
	BSF		TRISA,0
	BSF		TRISA,1
	CLRF	TRISB
	BANKSEL	PORTB
	CLRF	PORTA
	CLRF	PORTB

	BANKSEL	INTCON
	BSF		INTCON,GIE
	BSF		INTCON,PEIE

	BANKSEL	PIE1
	BSF		PIE1,TMR1IE

	BANKSEL	TMR1H
	MOVLW	0X3C
	MOVWF	TMR1H
	MOVLW	0XB0
	MOVWF	TMR1L

	BANKSEL	T1CON
	MOVLW	B'00010001'
	MOVWF	T1CON

	BANKSEL	COUNTER
	MOVLW	0x0A
	MOVWF	COUNTER
	MOVWF	REFERENCE

LOOP

	CALL	DELAY
	BTFSC	PORTA,0
	GOTO	INCREMENT
	CALL	DELAY
	BTFSS	PORTA,1
	GOTO	LOOP
	GOTO	DECREMENT
	
INCREMENT

	MOVLW	0X0F
	SUBWF	REFERENCE,W
	BTFSS	STATUS,C
	INCF	REFERENCE
	GOTO	LOOP

DECREMENT

	MOVLW	0X05
	SUBWF	REFERENCE,W
	BTFSS	STATUS,Z
	DECF	REFERENCE
	GOTO	LOOP

DELAY
	
	MOVLW	0XA0	
	MOVWF	COUNTER2

D1	
	
	MOVLW	0XA0
	MOVWF	COUNTER3

D2
	
	DECFSZ	COUNTER3
	GOTO	D2
	DECFSZ	COUNTER2
	GOTO	D1
	RETURN
	
END